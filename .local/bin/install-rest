#!/bin/sh

# Add steam and vscode dnf repos, needs to be before the dnf upgrade call
sudo dnf config-manager setopt rpmfusion-nonfree-steam.enabled=1 # steam repo
sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc
echo -e "[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\nautorefresh=1\ntype=rpm-md\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc" | sudo tee /etc/yum.repos.d/vscode.repo > /dev/null
sudo dnf copr enable scottames/ghostty -y > /dev/null 2>&1

# Install everything dnf
sudo dnf upgrade --refresh -y
sudo dnf install -y gnome-tweaks gnome-extensions-app ghostty nextcloud-client calibre steam code trash-cli kitty-terminfo pipx

# Set base dirs to english 
rm -f "$XDG_CONFIG_HOME/user-dirs.dirs"
LANG=en_US.UTF-8 xdg-user-dirs-update 
echo 'pt_PT' > "$XDG_CONFIG_HOME/user-dirs.locale" # Avoid annoying popup at boot

# Configure Zsh
ZINIT_HOME="$XDG_DATA_HOME/zinit"
bash -c "$(curl --fail --show-error --silent --location https://raw.githubusercontent.com/zdharma-continuum/zinit/HEAD/scripts/install.sh)" > /dev/null
# zsh -c 'zinit self-update'

# Configure Vim
curl -fLo "$XDG_CONFIG_HOME/vim/autoload/plug.vim" --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
mkdir -p "$XDG_CACHE_HOME/vim/swap" "$XDG_CACHE_HOME/vim/backup"

# Install nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash > /dev/null
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
nvm install --lts

# Install ranger - to use the most recent version since the latest release has too many bugs
pipx install git+https://github.com/ranger/ranger.git
pipx inject ranger-fm pillow

# Install gnome extensions - marcs14 is the power manager
pipx install gnome-extensions-cli
gext install accent-directories@taiwbi.com appindicatorsupport@rgcjonas.gmail.com auto-accent-colour@Wartybix drive-menu@gnome-shell-extensions.gcampax.github.com marcs14@gmail.com

# Install everything flathub
sudo flatpak remote-modify --enable flathub
sudo flatpak update -y
flatpak install -y flathub org.signal.Signal com.discordapp.Discord com.yubico.yubioath io.ente.photos com.brave.Browser com.bitwarden.desktop com.ktechpit.whatsie

# Install Betterbird 
sudo dnf remove -y opensc # gpg scdaemon wants full access so we remove this
sudo dnf install -y gnupg2-scdaemon 
flatpak install -y flathub eu.betterbird.Betterbird
flatpak override --user --filesystem="$GNUPGHOME" eu.betterbird.Betterbird 
gpg --import "$XDG_DATA_HOME/public.asc"

